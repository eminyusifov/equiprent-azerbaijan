# Docker Compose Configuration for EquipRent Platform\n# Supports both development and production environments\n\nversion: '3.8'\n\nservices:\n  # =====================================================\n  # Frontend Application\n  # =====================================================\n  app:\n    build:\n      context: .\n      dockerfile: Dockerfile\n      target: production\n    container_name: equiprent-app\n    ports:\n      - \"80:80\"\n    environment:\n      - NODE_ENV=production\n    restart: unless-stopped\n    healthcheck:\n      test: [\"CMD\", \"curl\", \"-f\", \"http://localhost/health\"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n      start_period: 30s\n    labels:\n      - \"traefik.enable=true\"\n      - \"traefik.http.routers.equiprent.rule=Host(`equiprent.az`)\"\n      - \"traefik.http.routers.equiprent.tls=true\"\n      - \"traefik.http.routers.equiprent.tls.certresolver=letsencrypt\"\n    networks:\n      - equiprent-network\n\n  # =====================================================\n  # Development Environment (Alternative)\n  # =====================================================\n  app-dev:\n    build:\n      context: .\n      dockerfile: Dockerfile\n      target: development\n    container_name: equiprent-app-dev\n    ports:\n      - \"5173:5173\"\n    volumes:\n      - .:/app\n      - /app/node_modules\n    environment:\n      - NODE_ENV=development\n    profiles:\n      - dev\n    networks:\n      - equiprent-network\n\n  # =====================================================\n  # Reverse Proxy (Traefik)\n  # =====================================================\n  traefik:\n    image: traefik:v3.0\n    container_name: equiprent-traefik\n    command:\n      - \"--api.dashboard=true\"\n      - \"--providers.docker=true\"\n      - \"--providers.docker.exposedbydefault=false\"\n      - \"--entrypoints.web.address=:80\"\n      - \"--entrypoints.websecure.address=:443\"\n      - \"--certificatesresolvers.letsencrypt.acme.tlschallenge=true\"\n      - \"--certificatesresolvers.letsencrypt.acme.email=admin@equiprent.az\"\n      - \"--certificatesresolvers.letsencrypt.acme.storage=/letsencrypt/acme.json\"\n      - \"--global.checknewversion=false\"\n      - \"--global.sendanonymoususage=false\"\n    ports:\n      - \"80:80\"\n      - \"443:443\"\n      - \"8080:8080\"  # Traefik dashboard\n    volumes:\n      - /var/run/docker.sock:/var/run/docker.sock:ro\n      - traefik-letsencrypt:/letsencrypt\n    labels:\n      - \"traefik.enable=true\"\n      - \"traefik.http.routers.traefik.rule=Host(`traefik.equiprent.az`)\"\n      - \"traefik.http.routers.traefik.tls=true\"\n      - \"traefik.http.routers.traefik.tls.certresolver=letsencrypt\"\n      - \"traefik.http.routers.traefik.service=api@internal\"\n    profiles:\n      - proxy\n    networks:\n      - equiprent-network\n    restart: unless-stopped\n\n  # =====================================================\n  # Monitoring (Optional)\n  # =====================================================\n  monitoring:\n    image: nginx:alpine\n    container_name: equiprent-monitoring\n    volumes:\n      - ./monitoring:/usr/share/nginx/html:ro\n    labels:\n      - \"traefik.enable=true\"\n      - \"traefik.http.routers.monitoring.rule=Host(`status.equiprent.az`)\"\n      - \"traefik.http.routers.monitoring.tls=true\"\n      - \"traefik.http.routers.monitoring.tls.certresolver=letsencrypt\"\n    profiles:\n      - monitoring\n    networks:\n      - equiprent-network\n    restart: unless-stopped\n\n# =====================================================\n# Networks\n# =====================================================\nnetworks:\n  equiprent-network:\n    driver: bridge\n    name: equiprent-network\n\n# =====================================================\n# Volumes\n# =====================================================\nvolumes:\n  traefik-letsencrypt:\n    name: traefik-letsencrypt\n\n# =====================================================\n# Usage Examples:\n# =====================================================\n\n# Development:\n# docker-compose --profile dev up -d\n\n# Production:\n# docker-compose up -d\n\n# With Proxy:\n# docker-compose --profile proxy up -d\n\n# With Monitoring:\n# docker-compose --profile monitoring up -d\n\n# Full Stack:\n# docker-compose --profile dev --profile proxy --profile monitoring up -d\n\n# Build and run:\n# docker-compose build && docker-compose up -d\n\n# View logs:\n# docker-compose logs -f app\n\n# Stop all services:\n# docker-compose down\n\n# Remove everything including volumes:\n# docker-compose down -v --remove-orphans\n"